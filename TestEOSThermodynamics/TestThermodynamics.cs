using COMColumnNS;
using ModelEngine;
using Math2;
using MathNet.Numerics.LinearAlgebra;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using ModelEngine;
using System.Diagnostics;
using System.Drawing;
using Units;
using Units.InsideOutExchanger;
using Units.UOM;
using Temperature = Units.UOM.Temperature;

namespace UnitTests
{
    [TestClass]
    public class TestThermodynamics
    {
        [TestMethod] // very fast
        public void TestModifiedThomasAlgorithm()
        {
            double[][] Matrix = new double[15][]
           {new  double [15] { 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [15] {-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [15] { 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [15] { 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [15] { 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [15] { 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [15] { 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [15] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [15] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [15] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0},
            new  double [15] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0},
            new  double [15] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0},
            new  double [15] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0},
            new  double [15] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0},
            new  double [15] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0}};

            double[] F = new double[15] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 };

            var watch = Stopwatch.StartNew();
            // the code that you want to measure comes here

            for (int i = 0; i < 10000; i++)
            {
                ModifiedThomasAlgorithm.Solve(Matrix, F);
            }

            watch.Stop();
            var elapsedMs = watch.ElapsedMilliseconds;
            System.Windows.Forms.MessageBox.Show(elapsedMs.ToString());

            return;
        }

        [TestMethod] // very fast
        public void TestModifiedThomasAlgorithm2()
        {
            double[][] Matrix = new double[15][]
           {new  double [15] { 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [15] {-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [15] { 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [15] { 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [15] { 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [15] { 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [15] { 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [15] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [15] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [15] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0},
            new  double [15] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0},
            new  double [15] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0},
            new  double [15] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0},
            new  double [15] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0},
            new  double [15] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0}};

            double[] F = new double[15] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 };
            List<Point> UPoints = new();
            List<Point> LPoints = new();

            for (int r = 0; r < Matrix.Length; r++)
            {
                for (int c = 0; c < Matrix[0].Length; c++)
                {
                    if (r > c + 1 && Matrix[r][c] != 0)
                        LPoints.Add(new Point(r, c));
                    if (r < c - 1 && Matrix[r][c] != 0)
                        UPoints.Add(new Point(r, c));
                }
            }

            var watch = System.Diagnostics.Stopwatch.StartNew();
            // the code that you want to measure comes here

            for (int i = 0; i < 10000; i++)
            {
                double[] res = ModifiedThomasAlgorithm.Solve2(Matrix, F, LPoints, UPoints);
            }

            watch.Stop();
            var elapsedMs = watch.ElapsedMilliseconds;
            System.Windows.Forms.MessageBox.Show(elapsedMs.ToString());

            return;
        }

        [TestMethod] // very fast
        public void TestModifiedThomasAlgorithm3()
        {
            double[][] Matrix = new double[28][]
           {new  double [28] { 1.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] {-1.0, 1.0, 1.0, 0.0, 0.0, 2.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0}};

            double[] F = new double[28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.1, 0.0, 0.0, 0.01, 0.0, 0.0, 0.01 };
            List<Point> UPoints = new();
            List<Point> LPoints = new();

            for (int r = 0; r < Matrix.Length; r++)
            {
                for (int c = 0; c < Matrix[0].Length; c++)
                {
                    if (r > c + 1 && Matrix[r][c] != 0)
                        LPoints.Add(new Point(r, c));
                    if (r < c - 1 && Matrix[r][c] != 0)
                        UPoints.Add(new Point(r, c));
                }
            }

            var watch = System.Diagnostics.Stopwatch.StartNew();
            // the code that you want to measure comes here

            for (int i = 0; i < 10000; i++)
            {
                double[] res = ModifiedThomasAlgorithm.Solve3(Matrix, F, LPoints, UPoints);
            }

            watch.Stop();
            var elapsedMs = watch.ElapsedMilliseconds;
            System.Windows.Forms.MessageBox.Show(elapsedMs.ToString());

            return;
        }

        [TestMethod] // fast
        public void TestNetNumerics()
        {
            double[][] Matrix = new double[28][]
           {new  double [28] { 1.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] {-1.0, 1.0, 1.0, 0.0, 0.0, 2.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0},
            new  double [28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0}};
            double[] F = new double[28] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.1, 0.0, 0.0, 0.01, 0.0, 0.0, 0.01 };

            Vector<double> res = Vector<double>.Build.DenseOfArray(F);

            var watch = System.Diagnostics.Stopwatch.StartNew();
            // the code that you want to measure comes here

            var A = Matrix<double>.Build.DenseOfRowArrays(Matrix);
            var B = Vector<double>.Build.DenseOfArray(F);

            //MathNet.Numerics.Control.UseNativeMKL();         //176 ms
            //MathNet.Numerics.Control.UseNativeOpenBLAS();  // 1627 ms
            MathNet.Numerics.Control.UseManaged();         // 162 ms

            //MathNet.Numerics.Control.LinearAlgebraProvider;

            for (int i = 0; i < 10000; i++)
            {
                ModifiedThomasAlgorithm.testNetNumericsinversion(A, B, ref res);
            }

            watch.Stop();
            var elapsedMs = watch.ElapsedMilliseconds;
            System.Windows.Forms.MessageBox.Show(elapsedMs.ToString());

            return;
        }

        /* [TestMethod]
        public  void  TestExtreme()
        {
            double [] MM = new  double [225]{ 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
           -1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
            0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
            0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
            0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
            0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
            0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0, 0.0,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0, 0.0,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0, 0.0,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0, 1.0,
            0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,-1.0, 1.0};

            //DenseMatrix<double > M = new  DenseMatrix<double >( 15, 15, MM, Extreme.Mathematics.MatrixElementOrder.NotApplicable, false);

            //DenseVector<double > F = Vector new  double [15] { 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 };
            //DenseVector.

            Vector V = new  Vector(VectorType.Column, F);

            Matrix res;
            for (int  i = 0; i < 1000; i++)
            {
                DenseMatrix<double > Mm = new  DenseMatrix<double >(15, 15, M, Extreme.Mathematics.MatrixElementOrder.NotApplicable, false);
            }

            return  ;
        }*/

        [TestMethod]
        public void TestH_Keq()
        {
            Components cc = new();
            BaseComp sc;

            sc = Thermodata.GetComponent("n-Butane");
            sc.MoleFraction = 0.9;
            cc.Add(sc);

            sc = Thermodata.GetComponent("Hydrogen");
            sc.MoleFraction = 0.1;
            cc.Add(sc);

            cc.Thermo.KMethod = enumEquiKMethod.PR76;


            TemperatureC T = 25;
            Pressure P = 6;

            //enumCalcResult cres = enumCalcResult.Converged;
            double[] res = ThermodynamicsClass.KMixArray(cc, P, T, cc.MoleFractions, cc.MoleFractions, out _, cc.Thermo);
        }

        [TestMethod]
        public void TestPSat()
        {
            Components cc = new();
            BaseComp sc;

            sc = Thermodata.GetComponent("n-Butane");
            sc.MoleFraction = 0.5;
            cc.Add(sc);

            sc = Thermodata.GetComponent("propane");
            sc.MoleFraction = 0.5;
            cc.Add(sc);


            TemperatureC T = 25;
            Pressure P = 6;

            double res = ThermodynamicsClass.CalcBubblePointP(cc, T, cc.Thermo);
        }

        [TestMethod]
        public void TestPCKWilson()
        {
            double[] X = new double[1];
            ThermoDynamicOptions thermo = new();
            thermo.Enthalpy = enumEnthalpy.PR76;
            thermo.KMethod = enumEquiKMethod.Wilson;
            thermo.CritPMethod = enumCritPMethod.TWU;
            thermo.CritTMethod = enumCritTMethod.TWU;
            thermo.OmegaMethod = enumOmegaMethod.LeeKesler;
            thermo.MW_Method = enumMW_Method.LeeKesler;

            double[] res;
            Components cc = new();

            PseudoComponent pc = new(0.615049, new Temperature(311.15), new Temperature(311.15), new Temperature(311.15), "Test", thermo);
            pc.Name = "PC" + cc.ComponentList.Count.ToString();
            pc.MoleFraction = 1;
            cc.Add(pc);

            X[0] = 1;

            TemperatureC T = 370;
            Pressure P = 6;
            res = ThermodynamicsClass.KMixArray(cc, P, T, X, X, out _, cc.Thermo);
        }

        [TestMethod]
        public void TestKMixCrude()
        {
            double[] res;
            Components cc = new();
            BaseComp sc;

            string[] c = new string[]{"H2O","Hydrogen","Nitrogen","CO","Oxygen","Methane","Ethylene","Ethane","CO2","H2S","Propene","Propane","i-Butane",
            "n-Butane","i-Pentane","n-Pentane","Quasi38*","Quasi45*","Quasi55*","Quasi65*","Quasi75*","Quasi85*","Quasi95*","Quasi105*","Quasi115*","Quasi125*",
            "Quasi135*","Quasi145*","Quasi155*","Quasi165*","Quasi175*","Quasi185*","Quasi195*","Quasi205*","Quasi215*","Quasi225*","Quasi235*","Quasi245*",
            "Quasi255*","Quasi265*","Quasi275*","Quasi285*","Quasi295*","Quasi305*","Quasi315*","Quasi325*","Quasi335*","Quasi345*","Quasi355*","Quasi365*",
            "Quasi375*","Quasi385*","Quasi395*","Quasi405*","Quasi415*","Quasi425*","Quasi435*","Quasi445*","Quasi460*","Quasi480*","Quasi500*","Quasi520*",
            "Quasi540*","Quasi560*","Quasi580*","Quasi600*","Quasi620*","Quasi640*","Quasi660*","Quasi680*","Quasi700*","Quasi720*","Quasi740*","Quasi775*",
            "Quasi825*","Quasi875*"};

            //double [] x = new  double []  {0.11962, 0.00190, 0.00000, 0.00000, 0.00000, 0.00355, 0.00000, 0.01813, 0.00000, 0.00099, 0.00000, 0.01070, 0.02054, 0.01243, 0.02686, 0.04282, 0.00051, 0.00818, 0.01996, 0.01489, 0.01575, 0.02810, 0.02886, 0.04733, 0.01624, 0.03913, 0.02958, 0.03639, 0.03162, 0.03278, 0.02920, 0.03165, 0.02464, 0.01935, 0.02301, 0.02842, 0.02424, 0.02049, 0.02778, 0.01301, 0.01428, 0.01195, 0.00419, 0.00193, 0.00027, 0.00004, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000 };
            //double [] x = new  double [] { 0.135732774414621, 0.00215468506415423, 0, 0, 0, 0.0040308022232848, 0, 0.0205695504978483, 0, 0.00112867577145799, 0, 0.012145088837949, 0.0233015561421689, 0.0141024421399901, 0.0304793692227981, 0.0485837079279351, 0.000575215436192718, 0.0092822005770224, 0.0226435863400046, 0.0168918871952106, 0.0178767122687875, 0.0318902910790664, 0.0327534194713751, 0.0537023657943689, 0.0184311210311017, 0.0444009322636192, 0.0335596469258279, 0.0412962160913424, 0.0358771869940697, 0.0371930155690997, 0.0331300014439141, 0.035914641309358, 0.0279557907376905, 0.021952113307905, 0.0261134905810872, 0.0322528765686226, 0.0275004545362876, 0.0232519132782944, 0.0315204595917805, 0.0147578354952504, 0.0162052371926885, 0.0135548574764113, 0.00474909354016855, 0.00219263685340534, 0.000302596460158383, 4.18107775868331E-05, 1.53775892680625E-06, 1.91804783680153E-07, 1.07983510399437E-08, 1.11511408933161E-09, 8.63899097261722E-11, 6.12581908949474E-12, 3.54050464074921E-13, 4.58746710586419E-14, 3.03699384603848E-15, 2.51208135433161E-16, 1.86238776871088E-17, 1.02074204103091E-18, 2.81077119585737E-20, 1.81203359796247E-22, 3.63679596787214E-25, 1.09412087254464E-27, 2.22854161297157E-30 };
            double[] x = new double[] { 0.986074, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000006, 0.000000, 0.000005, 0.000000, 0.000773, 0.009770, 0.003116, 0.000163, 0.000083, 0.000001, 0.000005, 0.000003, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 };
            double[] sg = new double[] { 1, 0.06992, 0.80712, 0.80013, 1.13874, 0.29967, 0.38358, 0.35601, 0.82610, 0.78914, 0.52144, 0.50715, 0.56249, 0.58377, 0.62402, 0.63031, 0.61505, 0.63181, 0.65515, 0.67719, 0.69724, 0.71462, 0.72864, 0.73863, 0.74390, 0.74539, 0.75097, 0.76004, 0.77054, 0.78041, 0.78757, 0.79003, 0.79329, 0.80040, 0.80916, 0.81738, 0.82290, 0.82423, 0.82671, 0.83135, 0.83742, 0.84419, 0.85095, 0.85696, 0.86150, 0.86383, 0.86476, 0.86833, 0.87408, 0.88118, 0.88880, 0.89612, 0.90231, 0.90654, 0.91222, 0.91518, 0.91866, 0.92236, 0.92771, 0.93286, 0.93419, 0.93675, 0.94200, 0.94962, 0.95925, 0.97056, 0.98320, 0.99685, 1.01116, 1.02553, 1.03532, 1.04510, 1.05489, 1.07201, 1.09648, 1.12094 };
            double[] bp = new double[] { 373.15, 20.5548, 77.3498, 81.6996, 90.1996, 111.625, 169.399, 184.55, 194.59801, 213.498, 225.399, 231.048, 261.42001, 272.6480103, 301.02802, 309.20901, 311.15, 318.15, 328.15, 338.15, 348.15, 358.15, 368.15, 378.15, 388.15, 398.15, 408.15, 418.15, 428.15, 438.15, 448.15, 458.15, 468.15, 478.15, 488.15, 498.15, 508.15, 518.15, 528.15, 538.15, 548.15, 558.15, 568.15, 578.15, 588.15, 598.15, 608.15, 618.15, 628.15, 638.15, 648.15, 658.15, 668.15, 678.15, 688.15, 698.15, 708.15, 718.15, 733.15, 753.15, 773.15, 793.15, 813.15, 833.15, 853.15, 873.15, 893.15, 913.15, 933.15, 953.15, 973.15, 993.15, 1013.15, 1048.15, 1098.15, 1148.15 };

            ThermoDynamicOptions thermo = new();
            thermo.Enthalpy = enumEnthalpy.Ideal;
            thermo.CritPMethod = enumCritPMethod.TWU;
            thermo.CritTMethod = enumCritTMethod.TWU;
            thermo.OmegaMethod = enumOmegaMethod.LeeKesler;

            for (int i = 0; i < x.Length; i++)
            {
                sc = Thermodata.GetComponent(c[i]);
                if (sc == null)
                {
                    PseudoComponent pc = new(new Temperature(bp[i]), sg[i], thermo);
                    pc.MoleFraction = x[i];
                    cc.Add(pc);
                }
                else
                {
                    sc.MoleFraction = x[i];
                    cc.Add(sc);
                }
            }
            TemperatureC T = 100;
            Pressure P = 6;

            res = ThermodynamicsClass.KMixArray(cc, P, T, x, x, out _, thermo);
            return;
        }

        [TestMethod]
        public void TestKMixOffGas()
        {
            double[] res;
            Components cc = new();
            BaseComp sc;

            string[] c = new string[]{"H2O","Hydrogen","Nitrogen","CO","Oxygen","Methane","Ethylene","Ethane","CO2","H2S","Propene","Propane","i-Butane",
            "n-Butane","i-Pentane","n-Pentane","Quasi38*","Quasi45*","Quasi55*","Quasi65*","Quasi75*","Quasi85*","Quasi95*","Quasi105*","Quasi115*","Quasi125*",
            "Quasi135*","Quasi145*","Quasi155*","Quasi165*","Quasi175*","Quasi185*","Quasi195*","Quasi205*","Quasi215*","Quasi225*","Quasi235*","Quasi245*",
            "Quasi255*","Quasi265*","Quasi275*","Quasi285*","Quasi295*","Quasi305*","Quasi315*","Quasi325*","Quasi335*","Quasi345*","Quasi355*","Quasi365*",
            "Quasi375*","Quasi385*","Quasi395*","Quasi405*","Quasi415*","Quasi425*","Quasi435*","Quasi445*","Quasi460*","Quasi480*","Quasi500*","Quasi520*",
            "Quasi540*","Quasi560*","Quasi580*","Quasi600*","Quasi620*","Quasi640*","Quasi660*","Quasi680*","Quasi700*","Quasi720*","Quasi740*","Quasi775*",
            "Quasi825*","Quasi875*"};

            double[] x = new double[] { 0,0,0,0,0,0,0,0.0138,0,0,0,0.2464,0.1077,0.3676,0.0367,0.0319,0.0176,0.0519,0.054 ,
                0.0374,0.0228,0.0099,0.0019,0.0002,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                0,0,0,0,0,0,0,0,0,0,0,0,0,0.0002,0 };

            //double [] x = new  double []  {0.11962, 0.00190, 0.00000, 0.00000, 0.00000, 0.00355, 0.00000, 0.01813, 0.00000, 0.00099, 0.00000, 0.01070, 0.02054, 0.01243, 0.02686, 0.04282, 0.00051, 0.00818, 0.01996, 0.01489, 0.01575, 0.02810, 0.02886, 0.04733, 0.01624, 0.03913, 0.02958, 0.03639, 0.03162, 0.03278, 0.02920, 0.03165, 0.02464, 0.01935, 0.02301, 0.02842, 0.02424, 0.02049, 0.02778, 0.01301, 0.01428, 0.01195, 0.00419, 0.00193, 0.00027, 0.00004, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000, 0.00000 };
            //double [] x = new  double [] { 0.135732774414621, 0.00215468506415423, 0, 0, 0, 0.0040308022232848, 0, 0.0205695504978483, 0, 0.00112867577145799, 0, 0.012145088837949, 0.0233015561421689, 0.0141024421399901, 0.0304793692227981, 0.0485837079279351, 0.000575215436192718, 0.0092822005770224, 0.0226435863400046, 0.0168918871952106, 0.0178767122687875, 0.0318902910790664, 0.0327534194713751, 0.0537023657943689, 0.0184311210311017, 0.0444009322636192, 0.0335596469258279, 0.0412962160913424, 0.0358771869940697, 0.0371930155690997, 0.0331300014439141, 0.035914641309358, 0.0279557907376905, 0.021952113307905, 0.0261134905810872, 0.0322528765686226, 0.0275004545362876, 0.0232519132782944, 0.0315204595917805, 0.0147578354952504, 0.0162052371926885, 0.0135548574764113, 0.00474909354016855, 0.00219263685340534, 0.000302596460158383, 4.18107775868331E-05, 1.53775892680625E-06, 1.91804783680153E-07, 1.07983510399437E-08, 1.11511408933161E-09, 8.63899097261722E-11, 6.12581908949474E-12, 3.54050464074921E-13, 4.58746710586419E-14, 3.03699384603848E-15, 2.51208135433161E-16, 1.86238776871088E-17, 1.02074204103091E-18, 2.81077119585737E-20, 1.81203359796247E-22, 3.63679596787214E-25, 1.09412087254464E-27, 2.22854161297157E-30 };
            //double [] x = new  double [] { 0.986074, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000006, 0.000000, 0.000005, 0.000000, 0.000773, 0.009770, 0.003116, 0.000163, 0.000083, 0.000001, 0.000005, 0.000003, 0.000001, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000, 0.000000 };
            double[] sg = new double[] { 1, 0.06992, 0.80712, 0.80013, 1.13874, 0.29967, 0.38358, 0.35601, 0.82610, 0.78914, 0.52144, 0.50715, 0.56249, 0.58377, 0.62402, 0.63031, 0.61505, 0.63181, 0.65515, 0.67719, 0.69724, 0.71462, 0.72864, 0.73863, 0.74390, 0.74539, 0.75097, 0.76004, 0.77054, 0.78041, 0.78757, 0.79003, 0.79329, 0.80040, 0.80916, 0.81738, 0.82290, 0.82423, 0.82671, 0.83135, 0.83742, 0.84419, 0.85095, 0.85696, 0.86150, 0.86383, 0.86476, 0.86833, 0.87408, 0.88118, 0.88880, 0.89612, 0.90231, 0.90654, 0.91222, 0.91518, 0.91866, 0.92236, 0.92771, 0.93286, 0.93419, 0.93675, 0.94200, 0.94962, 0.95925, 0.97056, 0.98320, 0.99685, 1.01116, 1.02553, 1.03532, 1.04510, 1.05489, 1.07201, 1.09648, 1.12094 };
            double[] bp = new double[] { 373.15, 20.5548, 77.3498, 81.6996, 90.1996, 111.625, 169.399, 184.55, 194.59801, 213.498, 225.399, 231.048, 261.42001, 272.6480103, 301.02802, 309.20901, 311.15, 318.15, 328.15, 338.15, 348.15, 358.15, 368.15, 378.15, 388.15, 398.15, 408.15, 418.15, 428.15, 438.15, 448.15, 458.15, 468.15, 478.15, 488.15, 498.15, 508.15, 518.15, 528.15, 538.15, 548.15, 558.15, 568.15, 578.15, 588.15, 598.15, 608.15, 618.15, 628.15, 638.15, 648.15, 658.15, 668.15, 678.15, 688.15, 698.15, 708.15, 718.15, 733.15, 753.15, 773.15, 793.15, 813.15, 833.15, 853.15, 873.15, 893.15, 913.15, 933.15, 953.15, 973.15, 993.15, 1013.15, 1048.15, 1098.15, 1148.15 };

            ThermoDynamicOptions thermo = new();
            thermo.Enthalpy = enumEnthalpy.Ideal;
            thermo.CritPMethod = enumCritPMethod.TWU;
            thermo.CritTMethod = enumCritTMethod.TWU;
            thermo.OmegaMethod = enumOmegaMethod.LeeKesler;
            thermo.UseBIPs = false;

            for (int i = 0; i < x.Length; i++)
            {
                sc = Thermodata.GetComponent(c[i]);
                if (sc == null)
                {
                    PseudoComponent pc = new(new Temperature(bp[i]), sg[i], thermo);
                    pc.MoleFraction = x[i];
                    cc.Add(pc);
                }
                else
                {
                    sc.MoleFraction = x[i];
                    cc.Add(sc);
                }
            }
            TemperatureC T = 50;
            Pressure P = 3;

            res = ThermodynamicsClass.KMixArray(cc, P, T, x, x, out _, thermo);
            return;
        }

        [TestMethod]
        public void KMix()
        {
            double[] res;
            Components cc = new();
            BaseComp sc;
            ThermoDynamicOptions thermo = new();
            thermo.KMethod = enumEquiKMethod.PR76;
            //Debugger.Launch();

            sc = Thermodata.GetComponent("n-Butane");
            cc.Add(sc);

            sc = Thermodata.GetComponent("Hydrogen");
            cc.Add(sc);

            double[] x = new double[] { 0.9, 0.1 };
            double[] y = new double[] { 0.9, 0.1 };


            TemperatureC T = 25;
            Pressure P = 3;

            res = ThermodynamicsClass.KMixArray(cc, P, T, x, y, out enumFluidRegion state, thermo);
            //return   res;
        }

        [TestMethod]
        public void TestFlash()
        {
            ThermoDynamicOptions thermo = new();
            thermo.Enthalpy = enumEnthalpy.LeeKesler;

            Components cc = new();
            BaseComp sc;

            sc = Thermodata.GetComponent("propane");
            sc.MoleFraction = 0.5;
            cc.Add(sc);

            sc = Thermodata.GetComponent("n-Butane");
            sc.MoleFraction = 0.4;
            cc.Add(sc);

            sc = Thermodata.GetComponent("n-C30");
            sc.MoleFraction = 0.1;
            cc.Add(sc);

            Port_Material p = new();
            p.cc.Add(cc);
            p.cc.Origin = SourceEnum.Input;
            p.T_ = new StreamProperty(ePropID.T, 273.15 + 100);
            p.P_.Value = new StreamProperty(ePropID.P, 6);

            p.Flash();

            Debug.Print(p.cc.LiqPhaseMolFractions[0].ToString());
            Debug.Print(p.cc.LiqPhaseMolFractions[1].ToString());
            Debug.Print(p.cc.LiqPhaseMolFractions[2].ToString());
        }

        [TestMethod]
        public void TestPCCreation()
        {
            DistPoint a = new(1, new Temperature(145.0));
            DistPoint b = new(5, new Temperature(158.0));
            DistPoint c = new(10, new Temperature(164.0));
            DistPoint d = new(20, new Temperature(169.0));
            DistPoint e = new(30, new Temperature(172.0));
            DistPoint f = new(50, new Temperature(179.0));
            DistPoint g = new(70, new Temperature(185.0));
            DistPoint h = new(80, new Temperature(189.0));
            DistPoint i = new(90, new Temperature(195.0));
            DistPoint j = new(95, new Temperature(200.0));
            DistPoint k = new(99, new Temperature(213.0));
            DistPoints points = new();
            points.Add(a);
            points.Add(b);
            points.Add(c);
            points.Add(d);
            points.Add(e);
            points.Add(f);
            points.Add(g);
            points.Add(h);
            points.Add(i);
            points.Add(j);
            points.Add(k);

            //double [] res = DistillationConvert.GetPseudoCompLVfromDistPoint s(BoilingPoint s.i(), point s,1,false);
        }

        [TestMethod]
        public void TestFugacity2()
        {
            COMThermo ethermo = new();

            double[] X = new double[3];
            double[] Y = new double[3];
            ThermoDynamicOptions thermo = new();
            thermo.Enthalpy = enumEnthalpy.PR78;
            string[] names = new string[3];

            names[0] = "propane";
            names[1] = "n-butane";
            names[2] = "n-C30";

            X[0] = 0.95;
            X[1] = 0.05;
            X[2] = 0.0;

            Y[0] = 0.99;
            Y[1] = 0.01;
            Y[2] = 0.0;

            // res = ethermo.LnKMix(names, X, Y, (273.15 + 25), 6, (int )enumEnthalpy.PR78);

            double[] res = (double[])ethermo.LnkRealMix(names, X, Y, (273.15 + 100), 6, (int)enumEnthalpy.PR78);

            //            Debug.Print (res.ToString() + " " + res2.ToString());
        }

        [TestMethod]
        public void TestFugacity()
        {
            COMThermo ethermo = new();

            double[] X = new double[3];
            double[] Y = new double[3];
            ThermoDynamicOptions thermo = new();
            thermo.Enthalpy = enumEnthalpy.PR78;
            string[] names = new string[3];

            names[0] = "propane";
            names[1] = "n-butane";
            names[2] = "n-C30";

            X[0] = 0.5;
            X[1] = 0.5;
            X[2] = 0.0;

            Y[0] = 0.5;
            Y[1] = 0.5;
            Y[2] = 0.0;

            // res = ethermo.LnKMix(names, X, Y, (273.15 + 25), 6, (int )enumEnthalpy.PR78);

            double[] res = (double[])ethermo.LnkRealMix(names, X, Y, (273.15 + 100), 6, (int)enumEnthalpy.PR78);

            //            Debug.Print (res.ToString() + " " + res2.ToString());
        }

        [TestMethod]
        public void TestIOExchanger()
        {
            UOMProperty cin = new(ePropID.T, 100);
            UOMProperty cout = new(ePropID.T, 120);
            UOMProperty hsin = new(ePropID.T, 150);
            UOMProperty hsout = new(ePropID.T, 130);

            cout.Source = SourceEnum.Transferred;
            hsin.Source = SourceEnum.Transferred;
            hsout.Source = SourceEnum.Empty;
            cin.Source = SourceEnum.Empty;

            IOExchanger ex = new(2, 3, hsin, hsout, cin, cout, true);

            ex.Init();
            ex.setconstraints(constraints.CSIN, 100, constraints.HSOUT, 130);
            ex.calcerrors();

            do
            {
                ex.CalcGradients();
                ex.createjacobian();

                ex.InverseJacobian();
                ex.UpdateDutyperKG();
                ex.Init();
                ex.calcerrors();
            }
            while (ex.geterror() > 0);
        }

        [TestMethod]
        public void TestMethaneTRAPP1()
        {
            ElyHanley test = new();
            test.TRAPP("METHANE", 100, 1);
        }

        [TestMethod]
        public void TestButaneTRAPP1()
        {
            ElyHanley test = new();
            test.TRAPP("N-BUTANE", 0, 6);
            test.TRAPP("N-BUTANE", 300, 6);
        }

        [TestMethod]
        public void TestTRAPP2()
        {
            BaseComp bc = Thermodata.GetComponent("n-Butane");
            ElyHanley test = new();
            test.TRAPP2(bc, 25, 6, out double visc, out double thermc, out double den);
            //test.TRAPP2(11.61, 0.2550, 425.20, 0.2753, 200, 1);
        }

        [TestMethod]
        public void TestTRAPPMethane()
        {
            BaseComp bc = Thermodata.GetComponent("methane");
            ElyHanley test = new();
            test.TRAPP2(bc, new Temperature(100), 1, out double visc, out double thermc, out double den);
        }

        [TestMethod]
        public void TestNormInv()
        {
            double val = Probability.NormSDist(0.5);
            val = Probability.NormSInv(val);
            Debug.Print(val.ToString());
        }

        [TestMethod]
        public void TestCubicSpline()
        {
            DistPoint a = new(1, new Temperature(-2.00));
            DistPoint b = new(5, new Temperature(26.00));
            DistPoint c = new(10, new Temperature(36.00));
            DistPoint d = new(20, new Temperature(68.00));
            DistPoint e = new(30, new Temperature(86.00));
            DistPoint f = new(50, new Temperature(109.00));
            DistPoint g = new(70, new Temperature(136.00));
            DistPoint h = new(80, new Temperature(148.00));
            DistPoint i = new(90, new Temperature(161.00));
            DistPoint j = new(95, new Temperature(168.00));
            DistPoint k = new(99, new Temperature(177.00));
            DistPoints points = new();
            points.Add(a);
            points.Add(b);
            points.Add(c);
            points.Add(d);
            points.Add(e);
            points.Add(f);
            points.Add(g);
            points.Add(h);
            points.Add(i);
            points.Add(j);
            points.Add(k);

            Debug.Print(Math2.CubicSpline.CubSpline(eSplineMethod.Normal, 150D, points.getPCTs(), points.GetKDoubles()).ToString());
        }

        [TestMethod]
        public void TestPCCreation2()
        {
            DistPoint a = new(1, new Temperature(355));
            DistPoint b = new(5, new Temperature(391));
            DistPoint c = new(10, new Temperature(411));
            DistPoint d = new(20, new Temperature(436));
            DistPoint e = new(30, new Temperature(454));
            DistPoint f = new(50, new Temperature(484));
            DistPoint g = new(70, new Temperature(514));
            DistPoint h = new(80, new Temperature(531));
            DistPoint i = new(90, new Temperature(553));
            DistPoint j = new(95, new Temperature(574));
            DistPoint k = new(99, new Temperature(624));
            DistPoints points = new();
            points.Add(a);
            points.Add(b);
            points.Add(c);
            points.Add(d);
            points.Add(e);
            points.Add(f);
            points.Add(g);
            points.Add(h);
            points.Add(i);
            points.Add(j);
            points.Add(k);

            //double [] res = DistillationConvert.GetPseudoCompLVfromDistPoint s(Global.BoilingPoint s.DegCtoDegK(), point s,1,false);
        }

        [TestMethod]
        public void TestPCCreation3()
        {
            ThermoDynamicOptions thermo = new();
            PseudoComponent pc = new(new Temperature(600), 0.9706, thermo);
        }

        [TestMethod]
        public void TestTWU()
        {
            TWU.Calc(new Temperature(825 + 273.15), 1.1);
            Debug.Print("MW " + TWU.MW.ToString());
            Debug.Print("Tc " + TWU.Tc.ToString());
            Debug.Print("Pc " + TWU.Pc.ToString());
            Debug.Print("Vc " + TWU.VcOut.ToString());
            Debug.Print("Zc " + TWU.Zc.ToString());
            Debug.Print("Omega " + TWU.Omega.ToString());
        }
    }
}